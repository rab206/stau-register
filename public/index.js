'use strict';var peopleMap={},peopleList=[],attendeeList=[],peopleField=document.getElementById('people'),dataList=document.getElementById('peopleList'),addedPeople=document.getElementById('addedPeople'),totalField=document.getElementById('total');document.getElementById('date').valueAsDate=new Date;var xhr=new XMLHttpRequest;xhr.open('GET','https://spreadsheets.google.com/feeds/list/1930OIvsDqXdQPBVBq5TpwGENVjHrZ11XBeF_WF4t7VY/1/public/values?alt=json',!0),xhr.onload=function(){200===xhr.status?(localStorage.setItem('people',xhr.response),onComplete(JSON.parse(xhr.response))):alert('Request failed.  Returned status of '+xhr.status)},xhr.onerror=function(){var c=localStorage.getItem('people');c&&onComplete(JSON.parse(c))},xhr.send();function compareNames(c,d){return c<d?-1:c>d?1:0}function comparePeople(c,d){(!c.surname||d.surname)&&(f=compareNames(c.name.toUpperCase(),d.name.toUpperCase()));var f=compareNames(c.surname.toUpperCase(),d.surname.toUpperCase());return 0===f&&(f=compareNames(c.name.toUpperCase(),d.name.toUpperCase())),f}function onComplete(c){var d=new Date(c.feed.updated.$t);document.getElementById('lastUpdated').textContent=d.toDateString(),document.getElementById('spreadsheet').href=c.feed.link[0].href;var f=c.feed.entry.filter((k)=>{return console.log(k.gsx$fullname),k.gsx$fullname&&k.gsx$fullname.$t.trim()&&'-'!=k.gsx$fullname.$t.trim()});f=f.map((k)=>{var l=k.gsx$fullname.$t.trim();l=l.replace(/\"/g,'\''),l=l.replace(/[ ]{1,}/g,' ');var m={name:l,surname:k.gsx$surname.$t,balance:k.gsx$currentbalance.$t};return peopleMap[l]=m,m}),f.sort(comparePeople);var g='<!--[if lte IE 9]><select data-datalist="peopleList"><![endif]-->';f.map((k)=>{peopleList.push(k.name),g+=`<option value="${k.name}">`}),g+='<!--[if lte IE 9]></select><![endif]-->',dataList.innerHTML=g,peopleField.placeholder='type name...';var h=!!(document.createElement('datalist')&&window.HTMLDataListElement);if(!h){var i=document.createElement('script');i.type='text/javascript',i.id='polyfill',i.src='datalist-polyfill.js',document.body.appendChild(i);document.body.insertAdjacentHTML('beforeend','<style>.datalist-polyfill{list-style:none;display:none;background:#fff;box-shadow:0 2px 2px #999;position:absolute;left:0;top:0;margin:0;padding:0;max-height:300px;overflow-y:auto}.datalist-polyfill:empty{display:none!important}.datalist-polyfill>li{padding:3px;font:13px "Lucida Grande",Sans-Serif}.datalist-polyfill__active{background:#3875d7;color:#fff}</style>'),peopleField.onblur=updateInput}}document.getElementById('form').onkeypress=(c)=>{13==c.keyCode&&c.preventDefault()};function capitalize(c){if(c){var d=c.split(' ');c='',d.map((f)=>{0<f.length&&(c+=f[0].toUpperCase()+f.slice(1)+' ')}),c=c.trim()}return c}document.getElementById('addPerson').onclick=addPerson,peopleField.oninput=updateInput;function updateInput(){var c=peopleField.value;c=capitalize(c),peopleList.includes(c)&&addPerson()}function addPerson(){var c=capitalize(peopleField.value);if(c&&0===attendeeList.filter((h)=>{return h.name===c}).length){var d='New person',f,g='';peopleMap[c]?(f=peopleMap[c],d=f.balance,d='\xA3'+d,d.includes('(')&&(g='red',d='-&pound;'+d.substring(2,d.length-1))):f={name:c,surname:c,balance:d,newPerson:!0},attendeeList.push(f),addedPeople.insertAdjacentHTML('afterbegin',`<tr id="${c}" class="stripe-dark ${g}">
          <td class="pa3">${c}</td>
          <td class="pa3">${d}</td>
          <td class="pa3"><input onClick="removePerson(this, '${c}')" class="b ph3 pv2 input-reset ba b--black bg-white grow pointer f6" type="button" value="Remove"></td>
        </tr>`),totalField.textContent=attendeeList.length}peopleField.value='',peopleField.focus()}function removePerson(c,d){c.parentElement.parentElement.remove(),attendeeList=attendeeList.filter((f)=>{return f.name!=d}),totalField.textContent=attendeeList.length}function getAttendeeList(){var c=[],d='';return attendeeList.sort(comparePeople),attendeeList.forEach((f)=>{f.newPerson?c.push(f):d+=f.name+'\r\n'}),0<c.length&&(d+='\r\nNew People; \r\n',c.forEach((f)=>{d+=f.name+'\r\n'})),d}document.getElementById('form').addEventListener('submit',(c)=>{c.preventDefault();var f=document.getElementById('date').value,g=document.getElementById('comment').value,h=`Register for  ${f}`,i=`Hi Treasurer,\r\n
Here is the register for ${f}.\r\n
\r\n
Comment: ${g}\r\n
\r\n
Register;
${getAttendeeList()}\r\n
\r\n
Thanks`;window.location.href='mailto:'+'treasurer@stalbansultimate.co.uk'+'?subject='+h+'&body='+encodeURIComponent(i),document.getElementById('warning').classList.remove('dn')}),'serviceWorker'in navigator&&window.addEventListener('load',function(){navigator.serviceWorker.register('/sw.js').then(function(c){console.log('ServiceWorker registration successful with scope: ',c.scope)}).catch(function(c){console.log('ServiceWorker registration failed: ',c)})});
//# sourceMappingURL=index.js.map
