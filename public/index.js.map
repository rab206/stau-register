{"version":3,"sources":["index.js"],"names":["tempscript","document","createElement","window","onload","getElementById","valueAsDate","Date","type","id","src","body","appendChild","peopleMap","peopleList","attendeeList","peopleField","dataList","addedPeople","totalField","onComplete","data","feed","updated","$t","textContent","lastUpdated","toDateString","entry","filter","p","gsx$firstname","trim","people","map","gsx$surname","name","balance","gsx$balance","newP","sort","a","toUpperCase","b","nameA","nameB","push","innerHTML","options","placeholder","remove","HTMLDataListElement","datalistSupported","polyfill","insertAdjacentHTML","onclick","addPerson","oninput","value","includes","val","substring","length","rowClass","focus","removePerson","element","parentElement","splice","indexOf","addEventListener","e","preventDefault","date","comment","join","location","href","subject","encodeURIComponent","emailBody","classList","navigator","serviceWorker","register","then","console","log","registration","scope","catch","err"],"mappings":"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","file":"index.js","sourcesContent":["var tempscript = document.createElement(\"script\");\nwindow.onload = function() {\n  // set the date field to today's date by default\n  document.getElementById('date').valueAsDate = new Date();\n\n  // fetch the data from google sheets\n\n  tempscript.type = \"text/javascript\";\n  tempscript.id = \"tempscript\";\n  tempscript.src = \"https://spreadsheets.google.com/feeds/list/1j9z1tQwSwxclM-ucThVbraR_JaQcvnwnPoDGFLGUFfU/2/public/values?alt=json-in-script&callback=onComplete\";\n  document.body.appendChild(tempscript);\n};\n\nwindow.onload = function() {\n  // set the date field to today's date by default\n  document.getElementById('date').valueAsDate = new Date();\n\n  // fetch the data from google sheets\n\n  tempscript.type = \"text/javascript\";\n  tempscript.id = \"tempscript\";\n  tempscript.src = \"https://spreadsheets.google.com/feeds/list/1j9z1tQwSwxclM-ucThVbraR_JaQcvnwnPoDGFLGUFfU/2/public/values?alt=json-in-script&callback=onComplete\";\n  document.body.appendChild(tempscript);\n};\n\nvar peopleMap = {}; // object of all people, name and balance\nvar peopleList = [];\nvar attendeeList = []; // list of all attendees\nvar peopleField = document.getElementById('people'); // field where person's name is entered\nvar dataList = document.getElementById('peopleList'); // list of people to show in drop down\nvar addedPeople = document.getElementById('addedPeople'); // table to show added people\nvar totalField = document.getElementById('total');\n\n// callback when google sheet loads\nfunction onComplete(data) {\n  // show the last updated date\n  var lastUpdated = new Date(data.feed.updated.$t);\n  document.getElementById(\"lastUpdated\").textContent = lastUpdated.toDateString();\n\n  // only keep the row if the name is not empty\n  var people = data.feed.entry.filter(p => {\n    return p.gsx$firstname.$t.trim() ? true : false;\n  });\n  // extract the data we want (full name and balance) and discard the rest\n  people = people.map(p => {\n    var name = p.gsx$firstname.$t.trim() + \" \" + p.gsx$surname.$t.trim();\n    var newP = {\n      name,\n      balance: p.gsx$balance.$t\n    };\n    peopleMap[name] = newP;\n    return newP;\n  });\n\n  // sort the names alphabetically\n  people.sort(function compare(a, b) {\n    var nameA = a.name.toUpperCase();\n    var nameB = b.name.toUpperCase();\n    if (nameA < nameB) {\n      return -1;\n    }\n    if (nameA > nameB) {\n      return 1;\n    }\n    return 0;\n  });\n  var options = '<!--[if lte IE 9]><select data-datalist=\"peopleList\"><![endif]-->'; // populate list of options\n  people.map(p => {\n    peopleList.push(p.name);\n    options += `<option value=\"${p.name}\">`;\n  });\n  options += \"<!--[if lte IE 9]></select><![endif]-->\";\n  dataList.innerHTML = options;\n  peopleField.placeholder = \"type name...\";\n\n  tempscript.remove();\n\n  var datalistSupported = !!(document.createElement('datalist') && window.HTMLDataListElement);\n\n  if(!datalistSupported) {\n    var polyfill = document.createElement(\"script\");\n    polyfill.type = \"text/javascript\";\n    polyfill.id = \"polyfill\";\n    polyfill.src = \"datalist-polyfill.js\";\n    document.body.appendChild(polyfill);\n    var style = '<style>.datalist-polyfill{list-style:none;display:none;background:#fff;box-shadow:0 2px 2px #999;position:absolute;left:0;top:0;margin:0;padding:0;max-height:300px;overflow-y:auto}.datalist-polyfill:empty{display:none!important}.datalist-polyfill>li{padding:3px;font:13px \"Lucida Grande\",Sans-Serif}.datalist-polyfill__active{background:#3875d7;color:#fff}</style>';\n    document.body.insertAdjacentHTML('beforeend', style);\n  }\n}\n\n// add the current person to the attendee list\ndocument.getElementById('addPerson').onclick = addPerson;\n\npeopleField.oninput = () => {\n  var val = peopleField.value;\n  if (peopleList.includes(val)) {\n    addPerson();\n  }\n};\n\nfunction addPerson() {\n  var name = peopleField.value;\n  // if they're not already on the list add them\n  if (name && !attendeeList.includes(name)) {\n    // if the person exists in the spreadsheet we show their balance, if not we show \"New person\"\n    var balance = \"New person\";\n\n    // highlight the people with a negative balance\n    var rowClass = \"\";\n    if (peopleMap[name]) {\n      balance = peopleMap[name].balance;\n      balance = \"Â£\" + balance;\n      if (balance.includes('(')) {\n        rowClass = \"red\";\n        balance = \"-&pound;\" + balance.substring(2, balance.length - 1);\n      }\n\n    }\n    // add the person to the table\n    addedPeople.insertAdjacentHTML(\"beforeend\",\n      `<tr class=\"stripe-dark ${rowClass}\">\n          <td class=\"pa3\">${name}</td>\n          <td class=\"pa3\">${balance}</td>\n          <td class=\"pa3\"><input onClick=\"removePerson(this, '${name}')\" class=\"b ph3 pv2 input-reset ba b--black bg-white grow pointer f6\" type=\"button\" value=\"Remove\"></td>\n        </tr>`);\n    attendeeList.push(name);\n    totalField.textContent = attendeeList.length;\n  }\n  // reset the search field\n  peopleField.value = \"\";\n  peopleField.focus();\n}\n\n// remove an attendee\n// element is the button clicked on, name is the name of the person\nfunction removePerson(element, name) {\n  // delete from table\n  element.parentElement.parentElement.remove();\n  // delete from attendee list\n  attendeeList.splice(attendeeList.indexOf(name), 1);\n  totalField.textContent = attendeeList.length;\n}\n\n// on submit prevent page submit and open email app instead\ndocument.getElementById('form').addEventListener(\"submit\", (e) => {\n  // prevent page submit\n  e.preventDefault();\n\n  // construct the mail to request\n  var email = 'treasurer@stalbansultimate.co.uk';\n  var date = document.getElementById('date').value;\n  var comment = document.getElementById('comment').value;\n  var subject = `Register for  ${date}`;\n  var emailBody =\n    `Hi Treasurer,\\r\\n\nHere is the register for ${date}.\\r\\n\n\\r\\n\nComment: ${comment}\\r\\n\n\\r\\n\nRegister;\n${attendeeList.join('\\r\\n')}\\r\\n\n\\r\\n\nThanks`;\n  window.location.href = \"mailto:\" + email + \"?subject=\" + subject + \"&body=\" + encodeURIComponent(emailBody);\n  // show the warning that email has been opened\n  document.getElementById('warning').classList.remove('dn');\n});\n/* global navigator */\n// add service worker so requests are cached offline and we get add to homescreen functionality\nif ('serviceWorker' in navigator) {\n  window.addEventListener('load', function() {\n    navigator.serviceWorker.register('/sw.js').then(function(registration) {\n      // Registration was successful\n      console.log('ServiceWorker registration successful with scope: ', registration.scope);\n    }).catch(function(err) {\n      // registration failed :(\n      console.log('ServiceWorker registration failed: ', err);\n    });\n  });\n}"]}