{"version":3,"sources":["index.js"],"names":["peopleMap","peopleList","attendeeList","peopleField","document","getElementById","dataList","addedPeople","totalField","valueAsDate","Date","xhr","XMLHttpRequest","open","onload","status","localStorage","setItem","response","onComplete","JSON","parse","alert","onerror","getItem","data","send","compareNames","nameA","nameB","comparePeople","a","surname","b","name","toUpperCase","result","feed","updated","$t","textContent","lastUpdated","toDateString","href","link","entry","filter","console","log","p","gsx$fullname","trim","people","map","replace","gsx$surname","balance","gsx$currentbalance","newP","sort","push","innerHTML","options","placeholder","createElement","window","HTMLDataListElement","datalistSupported","polyfill","type","id","src","body","appendChild","insertAdjacentHTML","onblur","updateInput","onkeypress","keyCode","e","preventDefault","capitalize","split","words","length","w","slice","onclick","addPerson","oninput","value","val","includes","person","substring","newPerson","rowClass","focus","removePerson","element","parentElement","remove","getAttendeeList","forEach","newPeople","attendeeString","addEventListener","date","comment","location","subject","encodeURIComponent","emailBody","classList","navigator","serviceWorker","register","then","registration","scope","catch","err"],"mappings":"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","file":"index.js","sourcesContent":["'use strict';\n\nvar peopleMap = {}; // object of all people, name and balance\nvar peopleList = [];\nvar attendeeList = []; // list of all attendees\nvar peopleField = document.getElementById('people'); // field where person's name is entered\nvar dataList = document.getElementById('peopleList'); // list of people to show in drop down\nvar addedPeople = document.getElementById('addedPeople'); // table to show added people\nvar totalField = document.getElementById('total');\n\n// initialise the date field to today\ndocument.getElementById('date').valueAsDate = new Date();\n\n// fetch the data from google spreadsheets\nvar xhr = new XMLHttpRequest();\nxhr.open('GET', 'https://spreadsheets.google.com/feeds/list/1930OIvsDqXdQPBVBq5TpwGENVjHrZ11XBeF_WF4t7VY/1/public/values?alt=json', true);\nxhr.onload = function() {\n  if (xhr.status === 200) {\n    localStorage.setItem('people', xhr.response);\n    onComplete(JSON.parse(xhr.response));\n  }\n  else {\n    alert('Request failed.  Returned status of ' + xhr.status);\n  }\n};\nxhr.onerror = function() {\n  var data = localStorage.getItem('people');\n  if (data) {\n    onComplete(JSON.parse(data));\n  }\n};\nxhr.send();\n\nfunction compareNames(nameA, nameB) {\n  if (nameA < nameB) {\n    return -1;\n  }\n  if (nameA > nameB) {\n    return 1;\n  }\n  return 0;\n}\n\nfunction comparePeople(a, b) {\n  if (!a.surname || b.surname) {\n    result = compareNames(a.name.toUpperCase(), b.name.toUpperCase());\n  }\n  var result = compareNames(a.surname.toUpperCase(), b.surname.toUpperCase());\n  if (result === 0) {\n    result = compareNames(a.name.toUpperCase(), b.name.toUpperCase());\n  }\n  return result;\n}\n\n// callback when google sheet loads\nfunction onComplete(data) {\n  // show the last updated date\n  var lastUpdated = new Date(data.feed.updated.$t);\n  document.getElementById(\"lastUpdated\").textContent = lastUpdated.toDateString();\n  document.getElementById(\"spreadsheet\").href = data.feed.link[0].href;\n\n  // only keep the row if the name is not empty\n  var people = data.feed.entry.filter(p => {\n    console.log(p.gsx$fullname);\n    return p.gsx$fullname && p.gsx$fullname.$t.trim() && p.gsx$fullname.$t.trim() != '-';\n  });\n  // extract the data we want (full name and balance) and discard the rest\n  people = people.map(p => {\n    var name = p.gsx$fullname.$t.trim();\n    name = name.replace(/\\\"/g, \"'\");\n    name = name.replace(/[ ]{1,}/g, \" \");\n    var newP = {\n      name,\n      surname: p.gsx$surname.$t,\n      balance: p.gsx$currentbalance.$t\n    };\n    peopleMap[name] = newP;\n    return newP;\n  });\n\n  // sort the names alphabetically\n  people.sort(comparePeople);\n  var options = '<!--[if lte IE 9]><select data-datalist=\"peopleList\"><![endif]-->'; // populate list of options\n  people.map(p => {\n    peopleList.push(p.name);\n    options += `<option value=\"${p.name}\">`;\n  });\n  options += \"<!--[if lte IE 9]></select><![endif]-->\";\n  dataList.innerHTML = options;\n  peopleField.placeholder = \"type name...\";\n\n  var datalistSupported = !!(document.createElement('datalist') && window.HTMLDataListElement);\n\n  if (!datalistSupported) {\n    var polyfill = document.createElement(\"script\");\n    polyfill.type = \"text/javascript\";\n    polyfill.id = \"polyfill\";\n    polyfill.src = \"datalist-polyfill.js\";\n    document.body.appendChild(polyfill);\n    var style = '<style>.datalist-polyfill{list-style:none;display:none;background:#fff;box-shadow:0 2px 2px #999;position:absolute;left:0;top:0;margin:0;padding:0;max-height:300px;overflow-y:auto}.datalist-polyfill:empty{display:none!important}.datalist-polyfill>li{padding:3px;font:13px \"Lucida Grande\",Sans-Serif}.datalist-polyfill__active{background:#3875d7;color:#fff}</style>';\n    document.body.insertAdjacentHTML('beforeend', style);\n    // add on blur event as oninput is not triggered by datalist polyfill\n    peopleField.onblur = updateInput;\n  }\n}\n\n// prevent enter key submit of the form\ndocument.getElementById('form').onkeypress = (e) => {\n  if (e.keyCode == 13) {\n    e.preventDefault();\n  }\n};\n\n// capitalize all words\nfunction capitalize(name) {\n  if (name) {\n    var words = name.split(' ');\n    name = \"\";\n    words.map((w) => {\n      if (w.length > 0) {\n        name += w[0].toUpperCase() + w.slice(1) + \" \";\n      }\n    });\n    name = name.trim();\n  }\n  return name;\n}\n\n// add the current person to the attendee list\ndocument.getElementById('addPerson').onclick = addPerson;\n\n// if the field value matches a person's name in the list\n// then add the person immediately\n// this works on clicking on a element in the list or just typing the full name\npeopleField.oninput = updateInput;\n\nfunction updateInput() {\n  var val = peopleField.value;\n  val = capitalize(val);\n  if (peopleList.includes(val)) {\n    addPerson();\n  }\n}\n\n// add a person to the table and to the list of attendees\nfunction addPerson() {\n  var name = capitalize(peopleField.value);\n  // if they're not already on the list add them\n  if (name && attendeeList.filter(p => {return p.name === name}).length === 0) {\n    // if the person exists in the spreadsheet we show their balance, if not we show \"New person\"\n    var balance = \"New person\";\n    var person;\n\n    // highlight the people with a negative balance\n    var rowClass = \"\";\n    if (peopleMap[name]) {\n      person = peopleMap[name];\n      balance = person.balance;\n      balance = \"Â£\" + balance;\n      if (balance.includes('(')) {\n        rowClass = \"red\";\n        balance = \"-&pound;\" + balance.substring(2, balance.length - 1);\n      }\n    }\n    else {\n      person = {\n        name,\n        surname: name,\n        balance,\n        newPerson: true,\n      };\n    }\n    attendeeList.push(person);\n\n    addedPeople.insertAdjacentHTML(\"afterbegin\",\n      `<tr id=\"${name}\" class=\"stripe-dark ${rowClass}\">\n          <td class=\"pa3\">${name}</td>\n          <td class=\"pa3\">${balance}</td>\n          <td class=\"pa3\"><input onClick=\"removePerson(this, '${name}')\" class=\"b ph3 pv2 input-reset ba b--black bg-white grow pointer f6\" type=\"button\" value=\"Remove\"></td>\n        </tr>`);\n        \n    // add the person to the table\n    totalField.textContent = attendeeList.length;\n  }\n  // reset the search field\n  peopleField.value = \"\";\n  peopleField.focus();\n}\n\n// remove an attendee\n// element is the button clicked on, name is the name of the person\nfunction removePerson(element, name) {\n  // delete from table\n  element.parentElement.parentElement.remove();\n  // delete from attendee list\n  attendeeList = attendeeList.filter(p => { return p.name != name });\n  totalField.textContent = attendeeList.length;\n}\n\nfunction getAttendeeList() {\n  var newPeople = [];\n  var attendeeString = \"\";\n  attendeeList.sort(comparePeople);\n  attendeeList.forEach(p => {\n    if (p.newPerson) {\n      newPeople.push(p);\n    }\n    else {\n      attendeeString += p.name + \"\\r\\n\";\n    }\n  });\n  if (newPeople.length > 0) {\n    attendeeString += \"\\r\\nNew People; \\r\\n\";\n    newPeople.forEach(p => {\n      attendeeString += p.name + \"\\r\\n\";\n    });\n  }\n  return attendeeString;\n}\n\n// on submit prevent page submit and open email app instead\ndocument.getElementById('form').addEventListener(\"submit\", (e) => {\n  // prevent page submit\n  e.preventDefault();\n\n  // construct the mail to request\n  var email = 'treasurer@stalbansultimate.co.uk';\n  var date = document.getElementById('date').value;\n  var comment = document.getElementById('comment').value;\n  var subject = `Register for  ${date}`;\n  var emailBody =\n    `Hi Treasurer,\\r\\n\nHere is the register for ${date}.\\r\\n\n\\r\\n\nComment: ${comment}\\r\\n\n\\r\\n\nRegister;\n${getAttendeeList()}\\r\\n\n\\r\\n\nThanks`;\n  window.location.href = \"mailto:\" + email + \"?subject=\" + subject + \"&body=\" + encodeURIComponent(emailBody);\n  // show the warning that email has been opened\n  document.getElementById('warning').classList.remove('dn');\n});\n/* global navigator */\n// add service worker so requests are cached offline and we get add to homescreen functionality\nif ('serviceWorker' in navigator) {\n  window.addEventListener('load', function() {\n    navigator.serviceWorker.register('/sw.js').then(function(registration) {\n      // Registration was successful\n      console.log('ServiceWorker registration successful with scope: ', registration.scope);\n    }).catch(function(err) {\n      // registration failed :(\n      console.log('ServiceWorker registration failed: ', err);\n    });\n  });\n}\n"]}